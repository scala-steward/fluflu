box: hseeberger/scala-sbt

build:
  steps:
    - script:
        name: sbt test
        code: |
          for v in "2.11.8" "2.12.0"; do
            sbt ++${v} coverage clean test coverageReport
          done

    - script:
        name: push coverage report to codecov
        code: |
          bash <(curl -s https://codecov.io/bash)

deploy:
  steps:
    - script:
        name: setup gpg secring.asc
        code: |
          gpg_key_path=$HOME/.sbt/gpg
          mkdir -p $gpg_key_path
          echo $GPG_KEY | base64 --decode > $gpg_key_path/secring.asc

    - script:
        name: deploy to snapshot repository
        code: |
          if [[ $(cat version.sbt) =~ "-SNAPSHOT" ]]; then
            for v in "2.11.8" "2.12.0"; do
              sbt ++${v} publishSigned
            done
          fi
